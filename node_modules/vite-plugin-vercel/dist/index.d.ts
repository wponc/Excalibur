import { ResolvedConfig, Plugin } from 'vite';
import { StdinOptions, BuildOptions } from 'esbuild';
import { z } from 'zod';
import { Rewrite, Redirect } from '@vercel/routing-utils';

/**
 * Schema definition for `.vercel/output/config.json`
 * @see {@link https://vercel.com/docs/build-output-api/v3#build-output-configuration}
 */

declare const vercelOutputConfigSchema: z.ZodObject<{
    version: z.ZodLiteral<3>;
    routes: z.ZodOptional<z.ZodArray<z.ZodUnion<[z.ZodObject<{
        src: z.ZodString;
        dest: z.ZodOptional<z.ZodString>;
        headers: z.ZodOptional<z.ZodRecord<z.ZodString, z.ZodString>>;
        methods: z.ZodOptional<z.ZodArray<z.ZodString, "many">>;
        status: z.ZodOptional<z.ZodNumber>;
        continue: z.ZodOptional<z.ZodBoolean>;
        check: z.ZodOptional<z.ZodBoolean>;
        missing: z.ZodOptional<z.ZodArray<z.ZodUnion<[z.ZodObject<{
            type: z.ZodLiteral<"host">;
            value: z.ZodString;
        }, "strict", z.ZodTypeAny, {
            value: string;
            type: "host";
        }, {
            value: string;
            type: "host";
        }>, z.ZodObject<{
            type: z.ZodLiteral<"header">;
            key: z.ZodString;
            value: z.ZodOptional<z.ZodString>;
        }, "strict", z.ZodTypeAny, {
            type: "header";
            key: string;
            value?: string | undefined;
        }, {
            type: "header";
            key: string;
            value?: string | undefined;
        }>, z.ZodObject<{
            type: z.ZodLiteral<"cookie">;
            key: z.ZodString;
            value: z.ZodOptional<z.ZodString>;
        }, "strict", z.ZodTypeAny, {
            type: "cookie";
            key: string;
            value?: string | undefined;
        }, {
            type: "cookie";
            key: string;
            value?: string | undefined;
        }>, z.ZodObject<{
            type: z.ZodLiteral<"query">;
            key: z.ZodString;
            value: z.ZodOptional<z.ZodString>;
        }, "strict", z.ZodTypeAny, {
            type: "query";
            key: string;
            value?: string | undefined;
        }, {
            type: "query";
            key: string;
            value?: string | undefined;
        }>]>, "many">>;
        has: z.ZodOptional<z.ZodArray<z.ZodUnion<[z.ZodObject<{
            type: z.ZodLiteral<"host">;
            value: z.ZodString;
        }, "strict", z.ZodTypeAny, {
            value: string;
            type: "host";
        }, {
            value: string;
            type: "host";
        }>, z.ZodObject<{
            type: z.ZodLiteral<"header">;
            key: z.ZodString;
            value: z.ZodOptional<z.ZodString>;
        }, "strict", z.ZodTypeAny, {
            type: "header";
            key: string;
            value?: string | undefined;
        }, {
            type: "header";
            key: string;
            value?: string | undefined;
        }>, z.ZodObject<{
            type: z.ZodLiteral<"cookie">;
            key: z.ZodString;
            value: z.ZodOptional<z.ZodString>;
        }, "strict", z.ZodTypeAny, {
            type: "cookie";
            key: string;
            value?: string | undefined;
        }, {
            type: "cookie";
            key: string;
            value?: string | undefined;
        }>, z.ZodObject<{
            type: z.ZodLiteral<"query">;
            key: z.ZodString;
            value: z.ZodOptional<z.ZodString>;
        }, "strict", z.ZodTypeAny, {
            type: "query";
            key: string;
            value?: string | undefined;
        }, {
            type: "query";
            key: string;
            value?: string | undefined;
        }>]>, "many">>;
        locale: z.ZodOptional<z.ZodObject<{
            redirect: z.ZodOptional<z.ZodRecord<z.ZodString, z.ZodString>>;
            cookie: z.ZodOptional<z.ZodString>;
        }, "strict", z.ZodTypeAny, {
            redirect?: Record<string, string> | undefined;
            cookie?: string | undefined;
        }, {
            redirect?: Record<string, string> | undefined;
            cookie?: string | undefined;
        }>>;
        middlewarePath: z.ZodOptional<z.ZodString>;
    }, "strict", z.ZodTypeAny, {
        src: string;
        dest?: string | undefined;
        headers?: Record<string, string> | undefined;
        methods?: string[] | undefined;
        status?: number | undefined;
        continue?: boolean | undefined;
        check?: boolean | undefined;
        missing?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        has?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        locale?: {
            redirect?: Record<string, string> | undefined;
            cookie?: string | undefined;
        } | undefined;
        middlewarePath?: string | undefined;
    }, {
        src: string;
        dest?: string | undefined;
        headers?: Record<string, string> | undefined;
        methods?: string[] | undefined;
        status?: number | undefined;
        continue?: boolean | undefined;
        check?: boolean | undefined;
        missing?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        has?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        locale?: {
            redirect?: Record<string, string> | undefined;
            cookie?: string | undefined;
        } | undefined;
        middlewarePath?: string | undefined;
    }>, z.ZodObject<{
        handle: z.ZodUnion<[z.ZodLiteral<"rewrite">, z.ZodLiteral<"filesystem">, z.ZodLiteral<"resource">, z.ZodLiteral<"miss">, z.ZodLiteral<"hit">, z.ZodLiteral<"error">]>;
        src: z.ZodOptional<z.ZodString>;
        dest: z.ZodOptional<z.ZodString>;
        status: z.ZodOptional<z.ZodNumber>;
    }, "strict", z.ZodTypeAny, {
        handle: "error" | "rewrite" | "filesystem" | "resource" | "miss" | "hit";
        src?: string | undefined;
        dest?: string | undefined;
        status?: number | undefined;
    }, {
        handle: "error" | "rewrite" | "filesystem" | "resource" | "miss" | "hit";
        src?: string | undefined;
        dest?: string | undefined;
        status?: number | undefined;
    }>]>, "many">>;
    images: z.ZodOptional<z.ZodObject<{
        sizes: z.ZodTuple<[z.ZodNumber, z.ZodNumber], null>;
        domains: z.ZodOptional<z.ZodArray<z.ZodString, "atleastone">>;
        minimumCacheTTL: z.ZodOptional<z.ZodNumber>;
        formats: z.ZodOptional<z.ZodArray<z.ZodUnion<[z.ZodLiteral<"image/avif">, z.ZodLiteral<"image/webp">]>, "atleastone">>;
        dangerouslyAllowSVG: z.ZodOptional<z.ZodBoolean>;
        contentSecurityPolicy: z.ZodOptional<z.ZodString>;
    }, "strict", z.ZodTypeAny, {
        sizes: [number, number];
        domains?: [string, ...string[]] | undefined;
        minimumCacheTTL?: number | undefined;
        formats?: ["image/avif" | "image/webp", ...("image/avif" | "image/webp")[]] | undefined;
        dangerouslyAllowSVG?: boolean | undefined;
        contentSecurityPolicy?: string | undefined;
    }, {
        sizes: [number, number];
        domains?: [string, ...string[]] | undefined;
        minimumCacheTTL?: number | undefined;
        formats?: ["image/avif" | "image/webp", ...("image/avif" | "image/webp")[]] | undefined;
        dangerouslyAllowSVG?: boolean | undefined;
        contentSecurityPolicy?: string | undefined;
    }>>;
    wildcard: z.ZodOptional<z.ZodArray<z.ZodObject<{
        domain: z.ZodString;
        value: z.ZodString;
    }, "strict", z.ZodTypeAny, {
        value: string;
        domain: string;
    }, {
        value: string;
        domain: string;
    }>, "many">>;
    overrides: z.ZodOptional<z.ZodRecord<z.ZodString, z.ZodObject<{
        path: z.ZodOptional<z.ZodString>;
        contentType: z.ZodOptional<z.ZodString>;
    }, "strict", z.ZodTypeAny, {
        path?: string | undefined;
        contentType?: string | undefined;
    }, {
        path?: string | undefined;
        contentType?: string | undefined;
    }>>>;
    cache: z.ZodOptional<z.ZodArray<z.ZodString, "many">>;
}, "strict", z.ZodTypeAny, {
    version: 3;
    routes?: ({
        src: string;
        dest?: string | undefined;
        headers?: Record<string, string> | undefined;
        methods?: string[] | undefined;
        status?: number | undefined;
        continue?: boolean | undefined;
        check?: boolean | undefined;
        missing?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        has?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        locale?: {
            redirect?: Record<string, string> | undefined;
            cookie?: string | undefined;
        } | undefined;
        middlewarePath?: string | undefined;
    } | {
        handle: "error" | "rewrite" | "filesystem" | "resource" | "miss" | "hit";
        src?: string | undefined;
        dest?: string | undefined;
        status?: number | undefined;
    })[] | undefined;
    images?: {
        sizes: [number, number];
        domains?: [string, ...string[]] | undefined;
        minimumCacheTTL?: number | undefined;
        formats?: ["image/avif" | "image/webp", ...("image/avif" | "image/webp")[]] | undefined;
        dangerouslyAllowSVG?: boolean | undefined;
        contentSecurityPolicy?: string | undefined;
    } | undefined;
    wildcard?: {
        value: string;
        domain: string;
    }[] | undefined;
    overrides?: Record<string, {
        path?: string | undefined;
        contentType?: string | undefined;
    }> | undefined;
    cache?: string[] | undefined;
}, {
    version: 3;
    routes?: ({
        src: string;
        dest?: string | undefined;
        headers?: Record<string, string> | undefined;
        methods?: string[] | undefined;
        status?: number | undefined;
        continue?: boolean | undefined;
        check?: boolean | undefined;
        missing?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        has?: ({
            value: string;
            type: "host";
        } | {
            type: "header";
            key: string;
            value?: string | undefined;
        } | {
            type: "cookie";
            key: string;
            value?: string | undefined;
        } | {
            type: "query";
            key: string;
            value?: string | undefined;
        })[] | undefined;
        locale?: {
            redirect?: Record<string, string> | undefined;
            cookie?: string | undefined;
        } | undefined;
        middlewarePath?: string | undefined;
    } | {
        handle: "error" | "rewrite" | "filesystem" | "resource" | "miss" | "hit";
        src?: string | undefined;
        dest?: string | undefined;
        status?: number | undefined;
    })[] | undefined;
    images?: {
        sizes: [number, number];
        domains?: [string, ...string[]] | undefined;
        minimumCacheTTL?: number | undefined;
        formats?: ["image/avif" | "image/webp", ...("image/avif" | "image/webp")[]] | undefined;
        dangerouslyAllowSVG?: boolean | undefined;
        contentSecurityPolicy?: string | undefined;
    } | undefined;
    wildcard?: {
        value: string;
        domain: string;
    }[] | undefined;
    overrides?: Record<string, {
        path?: string | undefined;
        contentType?: string | undefined;
    }> | undefined;
    cache?: string[] | undefined;
}>;
type VercelOutputConfig = z.infer<typeof vercelOutputConfigSchema>;

/**
 * Schema definition for `.vercel/output/config.json`
 * @see {@link https://vercel.com/docs/build-output-api/v3#build-output-configuration}
 */

declare const vercelOutputVcConfigSchema: z.ZodUnion<[z.ZodObject<{
    runtime: z.ZodLiteral<"edge">;
    entrypoint: z.ZodString;
    envVarsInUse: z.ZodOptional<z.ZodArray<z.ZodString, "many">>;
}, "strict", z.ZodTypeAny, {
    runtime: "edge";
    entrypoint: string;
    envVarsInUse?: string[] | undefined;
}, {
    runtime: "edge";
    entrypoint: string;
    envVarsInUse?: string[] | undefined;
}>, z.ZodObject<{
    runtime: z.ZodString;
    handler: z.ZodString;
    memory: z.ZodOptional<z.ZodNumber>;
    maxDuration: z.ZodOptional<z.ZodNumber>;
    environment: z.ZodOptional<z.ZodRecord<z.ZodString, z.ZodString>>;
    regions: z.ZodOptional<z.ZodArray<z.ZodString, "many">>;
}, "strict", z.ZodTypeAny, {
    runtime: string;
    handler: string;
    memory?: number | undefined;
    maxDuration?: number | undefined;
    environment?: Record<string, string> | undefined;
    regions?: string[] | undefined;
}, {
    runtime: string;
    handler: string;
    memory?: number | undefined;
    maxDuration?: number | undefined;
    environment?: Record<string, string> | undefined;
    regions?: string[] | undefined;
}>, z.ZodObject<{
    runtime: z.ZodString;
    handler: z.ZodString;
    memory: z.ZodOptional<z.ZodNumber>;
    maxDuration: z.ZodOptional<z.ZodNumber>;
    environment: z.ZodOptional<z.ZodRecord<z.ZodString, z.ZodString>>;
    regions: z.ZodOptional<z.ZodArray<z.ZodString, "many">>;
    launcherType: z.ZodLiteral<"Nodejs">;
    shouldAddHelpers: z.ZodOptional<z.ZodBoolean>;
    shouldAddSourcemapSupport: z.ZodOptional<z.ZodBoolean>;
    awsLambdaHandler: z.ZodOptional<z.ZodString>;
}, "strict", z.ZodTypeAny, {
    runtime: string;
    handler: string;
    launcherType: "Nodejs";
    memory?: number | undefined;
    maxDuration?: number | undefined;
    environment?: Record<string, string> | undefined;
    regions?: string[] | undefined;
    shouldAddHelpers?: boolean | undefined;
    shouldAddSourcemapSupport?: boolean | undefined;
    awsLambdaHandler?: string | undefined;
}, {
    runtime: string;
    handler: string;
    launcherType: "Nodejs";
    memory?: number | undefined;
    maxDuration?: number | undefined;
    environment?: Record<string, string> | undefined;
    regions?: string[] | undefined;
    shouldAddHelpers?: boolean | undefined;
    shouldAddSourcemapSupport?: boolean | undefined;
    awsLambdaHandler?: string | undefined;
}>]>;
type VercelOutputVcConfig = z.infer<typeof vercelOutputVcConfigSchema>;

/**
 * Schema definition for `.vercel/output/config.json`
 * @see {@link https://vercel.com/docs/build-output-api/v3#build-output-configuration}
 */

declare const vercelOutputPrerenderConfigSchema: z.ZodObject<{
    expiration: z.ZodUnion<[z.ZodNumber, z.ZodLiteral<false>]>;
    group: z.ZodOptional<z.ZodNumber>;
    bypassToken: z.ZodOptional<z.ZodString>;
    fallback: z.ZodOptional<z.ZodString>;
    allowQuery: z.ZodOptional<z.ZodArray<z.ZodString, "many">>;
}, "strict", z.ZodTypeAny, {
    expiration: number | false;
    group?: number | undefined;
    bypassToken?: string | undefined;
    fallback?: string | undefined;
    allowQuery?: string[] | undefined;
}, {
    expiration: number | false;
    group?: number | undefined;
    bypassToken?: string | undefined;
    fallback?: string | undefined;
    allowQuery?: string[] | undefined;
}>;
type VercelOutputPrerenderConfig = z.infer<typeof vercelOutputPrerenderConfigSchema>;

type ViteVercelRewrite = Rewrite & {
    enforce?: 'pre' | 'post';
};
type ViteVercelRedirect = Redirect & {
    enforce?: 'pre' | 'post';
};
interface ViteVercelConfig {
    /**
     * How long Functions should be allowed to run for every request in seconds.
     * If left empty, default value for your plan will is used.
     */
    defaultMaxDuration?: number;
    /**
     * Default expiration time (in seconds) for prerender functions.
     * Defaults to 86400 seconds (24h).
     * @see {@link https://vercel.com/docs/concepts/next.js/incremental-static-regeneration}
     * @see {@link https://vercel.com/docs/build-output-api/v3#vercel-primitives/prerender-functions/configuration}
     */
    expiration?: number;
    /**
     * Also known as Server Side Generation, or SSG.
     * If present, must build static files in `.vercel/output/static`.
     * Can be set to `false` to disable prerendering completely.
     */
    prerender?: ViteVercelPrerenderFn | false;
    /**
     * By default, all `api/*` endpoints are compiled under `.vercel/output/functions/api/*.func`.
     * If others serverless functions need to be compiled under `.vercel/output/functions`, they should be added here.
     * For instance, a framework can leverage this to have a generic ssr endpoint
     * without requiring the user to write any code.
     *
     * @example
     * ```
     * {
     *   additionalEndpoints: [
     *     {
     *       // can also be an Object representing an esbuild StdinOptions
     *       source: '/path/to/file.ts',
     *       // URL path of the handler, will be generated to `.vercel/output/functions/api/file.func/index.js`
     *       destination: '/api/file',
     *     }
     *   ]
     * }
     * ```
     */
    rewrites?: ViteVercelRewrite[];
    redirects?: ViteVercelRedirect[];
    cleanUrls?: boolean;
    trailingSlash?: boolean;
    additionalEndpoints?: ViteVercelApiEntry[];
    /**
     * Advanced configuration to override .vercel/output/config.json
     * @see {@link https://vercel.com/docs/build-output-api/v3#build-output-configuration}
     * @protected
     */
    config?: Partial<Omit<VercelOutputConfig, 'version'>>;
    /**
     * ISR and SSG pages are mutually exclusive. If a page is found in both, ISR prevails.
     * Keys are path relative to .vercel/output/functions directory, either without extension,
     * or with `.prerender-config.json` extension.
     * If you have multiple isr configurations pointing to the same underlying function, you can leverage the `symlink`
     * property. See example below.
     *
     * @example
     * ```
     * // Here `ssr_` means that a function is available under `.vercel/output/functions/ssr_.func`
     * isr: {
     *   '/pages/a': { expiration: 15, symlink: 'ssr_', route: '^/a/.*$' },
     *   '/pages/b/c': { expiration: 15, symlink: 'ssr_', route: '^/b/c/.*$' },
     *   '/pages/d': { expiration: 15, symlink: 'ssr_', route: '^/d$' },
     *   '/pages/e': { expiration: 25 }
     * }
     * ```
     *
     * @protected
     */
    isr?: Record<string, VercelOutputIsr> | (() => Promise<Record<string, VercelOutputIsr>> | Record<string, VercelOutputIsr>);
    /**
     * Defaults to `.vercel/output`. Mostly useful for testing purpose
     * @protected
     */
    outDir?: string;
}
interface VercelOutputIsr extends VercelOutputPrerenderConfig {
    symlink?: string;
    route?: string;
}
/**
 * Keys are path relative to .vercel/output/static directory
 */
type ViteVercelPrerenderRoute = VercelOutputConfig['overrides'];
type ViteVercelPrerenderFn = (resolvedConfig: ResolvedConfig) => ViteVercelPrerenderRoute | Promise<ViteVercelPrerenderRoute>;
interface ViteVercelApiEntry {
    /**
     * Path to entry file, or stdin config
     */
    source: string | StdinOptions;
    /**
     * Relative to `.vercel/output/functions`, without extension
     */
    destination: string;
    /**
     * Override esbuild options
     */
    buildOptions?: BuildOptions;
    /**
     * Automatically add a route for the function (mimics defaults Vercel behavior)
     * Set to `false` to disable
     */
    addRoute?: boolean;
    /**
     * Set to `true` to mark this function as an Edge Function
     */
    edge?: boolean;
}

declare function allPlugins(): Plugin[];

export { VercelOutputConfig, VercelOutputIsr, VercelOutputPrerenderConfig, VercelOutputVcConfig, ViteVercelApiEntry, ViteVercelConfig, ViteVercelPrerenderFn, ViteVercelPrerenderRoute, ViteVercelRedirect, ViteVercelRewrite, allPlugins as default };
